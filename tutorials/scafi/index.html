<!DOCTYPE html>
<html lang="en" dir="ltr" itemscope itemtype="http://schema.org/Article" data-r-output-format="html">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.145.0">
    <meta name="generator" content="Relearn 7.5.0">
    <meta name="description" content="Ready-to-run examples of increasing complexity with the Scafi incarnation">
    <meta name="author" content="Danilo Pianini">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Scafi Incarnation Tutorial :: Documentation for the Alchemist Simulator">
    <meta name="twitter:description" content="Ready-to-run examples of increasing complexity with the Scafi incarnation">
    <meta property="og:url" content="https://alchemistsimulator.github.io/tutorials/scafi/index.html">
    <meta property="og:site_name" content="Documentation for the Alchemist Simulator">
    <meta property="og:title" content="Scafi Incarnation Tutorial :: Documentation for the Alchemist Simulator">
    <meta property="og:description" content="Ready-to-run examples of increasing complexity with the Scafi incarnation">
    <meta property="og:locale" content="en">
    <meta property="og:type" content="website">
    <meta itemprop="name" content="Scafi Incarnation Tutorial :: Documentation for the Alchemist Simulator">
    <meta itemprop="description" content="Ready-to-run examples of increasing complexity with the Scafi incarnation">
    <meta itemprop="wordCount" content="2372">
    <meta itemprop="keywords" content="Scala,Scafi,Scala Fields,Tutorial,Aggregate,Aggregate Computing,Aggregate Programming">
    <title>Scafi Incarnation Tutorial :: Documentation for the Alchemist Simulator</title>
    <link href="../../tutorials/scafi/index.xml" rel="alternate" type="application/rss+xml" title="Scafi Incarnation Tutorial :: Documentation for the Alchemist Simulator">
    <link href="../../images/logo.svg?1741606751" rel="icon" type="image/svg+xml">
    <link href="../../fonts/fontawesome/css/fontawesome-all.min.css?1741606751" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../fonts/fontawesome/css/fontawesome-all.min.css?1741606751" rel="stylesheet"></noscript>
    <link href="../../css/perfect-scrollbar/perfect-scrollbar.min.css?1741606751" rel="stylesheet">
    <link href="../../css/theme.min.css?1741606751" rel="stylesheet">
    <link href="../../css/format-html.min.css?1741606751" rel="stylesheet" id="R-format-style">
    <link href="../../css/auto-complete/auto-complete.min.css?1741606751" rel="stylesheet">
    <script src="../../js/auto-complete/auto-complete.min.js?1741606751" defer></script>
    <script src="../../js/lunr/lunr.min.js?1741606751" defer></script>
    <script src="../../js/lunr/lunr.stemmer.support.min.js?1741606751" defer></script>
    <script src="../../js/lunr/lunr.multi.min.js?1741606751" defer></script>
    <script src="../../js/lunr/lunr.en.min.js?1741606751" defer></script>
    <script src="../../js/search.min.js?1741606751" defer></script>
    <script>
      window.relearn = window.relearn || {};
      // configuration
      window.relearn.min = `.min`;
      window.relearn.relBasePath='..\/..';
      window.relearn.relBaseUri='..\/..';
      window.relearn.absBaseUri='https:\/\/alchemistsimulator.github.io';
      window.relearn.contentLangs=['en'];
      window.relearn.index_js_url="../../searchindex.en.js?1741606751";
      window.relearn.disableAnchorCopy=false;
      window.relearn.disableAnchorScrolling=false;
      window.relearn.disableInlineCopyToClipboard=false;
      window.relearn.enableBlockCodeWrap=true;
      // variant stuff
      window.relearn.themevariants = [ 'relearn' ];
      window.relearn.customvariantname = "my-custom-variant";
      window.relearn.changeVariant = function(variant) {
        var oldVariant = document.documentElement.dataset.rThemeVariant;
        window.localStorage.setItem(window.relearn.absBaseUri + "/variant", variant);
        document.documentElement.dataset.rThemeVariant = variant;
        if (oldVariant != variant) {
          document.dispatchEvent( new CustomEvent('themeVariantLoaded', { detail: { variant, oldVariant } }) );
        }
      }
      window.relearn.markVariant = function() {
        var variant = window.localStorage.getItem(window.relearn.absBaseUri + "/variant");
        var select = document.querySelector("#R-select-variant");
        if (select) {
          select.value = variant;
        }
      }
      window.relearn.initVariant = function() {
        var variant = window.localStorage.getItem(window.relearn.absBaseUri + "/variant") ?? "";
        if( variant == window.relearn.customvariantname ){
        }else if( !variant || !window.relearn.themevariants.includes(variant) ){
          variant = window.relearn.themevariants[0];
          window.localStorage.setItem(window.relearn.absBaseUri + "/variant", variant);
        }
        document.documentElement.dataset.rThemeVariant = variant;
      }
      window.relearn.initVariant();
      window.relearn.markVariant();
      // translations
      window.T_Copy_to_clipboard = `Copy to clipboard`;
      window.T_Copied_to_clipboard = `Copied to clipboard!`;
      window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
      window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
      window.T_Reset_view = `Reset view`;
      window.T_View_reset = `View reset!`;
      window.T_No_results_found = `No results found for "{0}"`;
      window.T_N_results_found = `{1} results found for "{0}"`;
    </script><script src="https://code.jquery.com/jquery-3.6.4.min.js" integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8=" crossorigin="anonymous"></script>
<script src="../../citations.js"></script>

  </head>
  <body class="mobile-support html" data-url="../../tutorials/scafi/index.html">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      <nav id="R-topbar">
        <div class="topbar-wrapper">
          <div class="topbar-sidebar-divider"></div>
          <div class="topbar-area topbar-area-start" data-area="start">
            <div class="topbar-button topbar-button-sidebar" data-content-empty="disable" data-width-s="show" data-width-m="hide" data-width-l="hide"><button class="topbar-control" onclick="toggleNav()" type="button" title="Menu (CTRL&#43;ALT&#43;n)"><i class="fa-fw fas fa-bars"></i></button>
            </div>
            <div class="topbar-button topbar-button-toc" data-content-empty="hide" data-width-s="show" data-width-m="show" data-width-l="show"><button class="topbar-control" onclick="toggleTopbarFlyout(this)" type="button" title="Table of Contents (CTRL&#43;ALT&#43;t)"><i class="fa-fw fas fa-list-alt"></i></button>
              <div class="topbar-content">
                <div class="topbar-content-wrapper">
<nav class="TableOfContents">
  <ul>
    <li><a href="#how-to-use-scafi-with-alchemist">How to use ScaFi with Alchemist</a></li>
  </ul>

  <ul>
    <li><a href="#requirements">Requirements</a></li>
    <li><a href="#quickstart">Quickstart</a>
      <ul>
        <li><a href="#what-happened">What happened</a></li>
      </ul>
    </li>
    <li><a href="#guided-examples">Guided examples</a>
      <ul>
        <li><a href="#1-hello-scafi-a-gradient-in-space-and-time">1. Hello, ScaFi! A gradient in space and time</a></li>
        <li><a href="#2-a-richer-pattern-self-organizing-coordination-regions">2. A richer pattern: Self-organizing Coordination Regions</a></li>
        <li><a href="#3-overlapping-computations-in-space-and-time-with-aggregate-processes">3. Overlapping computations in space and time with aggregate processes</a></li>
      </ul>
    </li>
    <li><a href="#external-resources-to-improve-your-understanding">External resources to improve your understanding</a></li>
  </ul>
</nav>
                </div>
              </div>
            </div>
          </div>
          <ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype="http://schema.org/BreadcrumbList">
            <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement" class=""><a itemprop="item" href="../../index.html"><span itemprop="name">The Alchemist Simulator</span></a><meta itemprop="position" content="1">&nbsp;>&nbsp;</li>
            <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement" class=""><a itemprop="item" href="../../tutorials/index.html"><span itemprop="name">Tutorials</span></a><meta itemprop="position" content="2">&nbsp;>&nbsp;</li>
            <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement" class=""><span itemprop="name">Scafi Incarnation Tutorial</span><meta itemprop="position" content="3"></li>
          </ol>
          <div class="topbar-area topbar-area-end" data-area="end">
            <div class="topbar-button topbar-button-edit" data-content-empty="disable" data-width-s="area-more" data-width-m="show" data-width-l="show"><a class="topbar-control" href="https://github.com/AlchemistSimulator/Alchemist/edit/master/site/content/tutorials/scafi/_index.md" rel="external" target="_blank" title="Edit (CTRL+ALT+w)"><i class="fa-fw fas fa-pen"></i></a>
            </div>
            <div class="topbar-button topbar-button-prev" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="../../tutorials/sapere/index.html" title="SAPERE Incarnation Tutorial (🡐)"><i class="fa-fw fas fa-chevron-left"></i></a>
            </div>
            <div class="topbar-button topbar-button-next" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="../../howtos/index.html" title="How-to Guides (🡒)"><i class="fa-fw fas fa-chevron-right"></i></a>
            </div>
            <div class="topbar-button topbar-button-more" data-content-empty="hide" data-width-s="show" data-width-m="show" data-width-l="show"><button class="topbar-control" onclick="toggleTopbarFlyout(this)" type="button" title="More"><i class="fa-fw fas fa-ellipsis-v"></i></button>
              <div class="topbar-content">
                <div class="topbar-content-wrapper">
                  <div class="topbar-area topbar-area-more" data-area="more">
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </nav>
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable tutorials" tabindex="-1">
        <div class="flex-block-wrapper">
<article class="default">
  <header class="headline">
<div class="R-taxonomy taxonomy-tags cstyle tags" title="Tags" style="--VARIABLE-TAGS-BG-color: var(--INTERNAL-TAG-BG-color);">
  <ul>
    <li><a class="term-link" href="../../tags/aggregate/index.html">Aggregate</a></li>
    <li><a class="term-link" href="../../tags/aggregate-computing/index.html">Aggregate Computing</a></li>
    <li><a class="term-link" href="../../tags/aggregate-programming/index.html">Aggregate Programming</a></li>
    <li><a class="term-link" href="../../tags/scafi/index.html">Scafi</a></li>
    <li><a class="term-link" href="../../tags/scala/index.html">Scala</a></li>
    <li><a class="term-link" href="../../tags/scala-fields/index.html">Scala Fields</a></li>
    <li><a class="term-link" href="../../tags/tutorial/index.html">Tutorial</a></li>
  </ul>
</div>
  </header>

<h1 id="scafi-incarnation-tutorial">Scafi Incarnation Tutorial</h1>

<p>ScaFi (Scala Fields) is a Scala-based library and framework for Aggregate Programming.
It implements a variant of the Higher-Order Field Calculus (HOFC) operational semantics,
which is made available as a usable domain-specific language (DSL),
and provides a platform and API for simulating and executing Aggregate Computing systems and applications.</p>
<h2 id="how-to-use-scafi-with-alchemist">How to use ScaFi with Alchemist</h2>
<p>For more details about ScaFi please read the
documentation in the <a href="https://scafi.github.io/docs/" rel="external" target="_blank">official site</a>
where you can find a description of how to integrate ScaFi toolkit
with Alchemist.</p>
<p>A tutorial similar to the <a href="../../tutorials/basics/index.html">base tutorial</a>, with increasingly rich examples,
focused on the Scafi incarnation.</p>
<p>The tutorial can be found on <a href="https://github.com/scafi/learning-scafi-alchemist" rel="external" target="_blank">GitHub</a>.
The <code>README.md</code> file of the project explains the use and the steps to follow.</p>
<h1 id="simulations-with-alchemist-and-scafi-tutorial">Simulations with Alchemist and Scafi: tutorial</h1>
<p>This tutorial presents a sequence of increasingly rich examples using the <a href="https://scafi.github.io" rel="external" target="_blank">Scafi aggregate programming DSL</a> and <a href="https://alchemistsimulator.github.io/" rel="external" target="_blank">the Alchemist Simulator</a>.</p>
<h2 id="requirements">Requirements</h2>
<ul>
<li>A <a href="https://docs.gradle.org/current/userguide/compatibility.html" rel="external" target="_blank">Gradle-compatible Java version</a> e.g., <a href="https://adoptium.net/temurin/releases/" rel="external" target="_blank">temurin</a></li>
<li>A local installation of <a href="https://git-scm.com/" rel="external" target="_blank">Git</a></li>
<li>[Optional] A working version of Python 3 for the plotting part</li>
</ul>
<p><strong>Check if it works</strong></p>
<p>Open a terminal and type</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>java -version
git --version</code></pre></div>
<p>Now you are ready to launch Alchemist &amp; ScaFi simulations</p>
<h2 id="quickstart">Quickstart</h2>
<p>Open a terminal and run:</p>
<p><strong>Windows</strong></p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span><span style="color:#ff5c57">curl </span>https<span style="color:#ff5c57">:</span>//raw.githubusercontent.com/scafi/<span style="color:#ff5c57">learning-scafi</span>-alchemist/master/launch.ps1 | <span style="color:#ff5c57">Select-Object</span> -ExpandProperty Content | powershell.exe</span></span></code></pre></div>
<p><strong>Linux &amp; Mac</strong></p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl https://raw.githubusercontent.com/scafi/learning-scafi-alchemist/master/launch.sh | bash</span></span></code></pre></div>
<p>It will take some time for the system to download all the required dependencies,
at the end of the process you will be presented
the Alchemist default GUI
(<a href="https://alchemistsimulator.github.io/reference/default-ui/" rel="external" target="_blank">here</a> are instructions on how to interact with the simulator).
At this point, the simulation should be looking like this:
<a href="#R-image-050fc9496770322ab8de43cbcfd71ac2" class="lightbox-link"><img alt="Alchemist simulation start" class="lazy lightbox figure-image" loading="lazy" src="https://user-images.githubusercontent.com/23448811/175499943-f346221b-9308-4cf0-8402-d90ad3bc56c6.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-050fc9496770322ab8de43cbcfd71ac2"><img alt="Alchemist simulation start" class="lazy lightbox lightbox-image" loading="lazy" src="https://user-images.githubusercontent.com/23448811/175499943-f346221b-9308-4cf0-8402-d90ad3bc56c6.png"></a></p>
<p>Click <kbd>P</kbd> to start the simulation.
The nodes will compute the ScaFi program described
<a href="https://github.com/scafi/learning-scafi-alchemist/blob/master/src/main/scala/it/unibo/scafi/examples/HelloScafi.scala" rel="external" target="_blank">here</a>)
in rounds,
producing node colour changes.
<a href="#R-image-d1a8b3f01ba4cebaf1447335d60c2ece" class="lightbox-link"><img alt="Alchemist simulation evolution" class="lazy lightbox figure-image" loading="lazy" src="https://user-images.githubusercontent.com/23448811/175502234-a2c5ae1a-c909-4545-ba5e-8cea0441cbd3.gif" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-d1a8b3f01ba4cebaf1447335d60c2ece"><img alt="Alchemist simulation evolution" class="lazy lightbox lightbox-image" loading="lazy" src="https://user-images.githubusercontent.com/23448811/175502234-a2c5ae1a-c909-4545-ba5e-8cea0441cbd3.gif"></a></p>
<h3 id="what-happened">What happened</h3>
<p>Issuing the one-liner command, you have:</p>
<ol>
<li>downloaded this repository using Git</li>
<li>created a folder called <code>learning-scafi-alchemist</code> that contains the simulations</li>
<li>executed the command <code>./gradlew runHelloScafi</code> inside the <code>learning-scafi-alchemist</code> created above.</li>
</ol>
<p>The last command produces the execution of the simulation called <code>helloScafi</code> described using a <code>yml</code> <a href="https://github.com/scafi/learning-scafi-alchemist/blob/master/src/main/yaml/helloScafi.yml" rel="external" target="_blank">file</a>.
Particularly an Alchemist simulation typically consists of a network of devices that could communicate with each other by means of a neighbourhood relationship (you can see the connections by clicking <kbd>L</kbd>)
<a href="#R-image-c11d62e6d1fcb6cd82525a78e0aaefef" class="lightbox-link"><img alt="Alchemist Neibourhood Relationship" class="lazy lightbox figure-image" loading="lazy" src="https://user-images.githubusercontent.com/23448811/175505269-cb2f6281-d7f2-40ff-9a11-fe7301166092.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-c11d62e6d1fcb6cd82525a78e0aaefef"><img alt="Alchemist Neibourhood Relationship" class="lazy lightbox lightbox-image" loading="lazy" src="https://user-images.githubusercontent.com/23448811/175505269-cb2f6281-d7f2-40ff-9a11-fe7301166092.png"></a>
In this case, the nodes&rsquo; positions are configured through real GPS traces from the Vienna marathon app.
The simulation effects (i.e., node shapes and colours) are highly configurable through JSON <a href="https://github.com/scafi/learning-scafi-alchemist/blob/master/effects/helloScafi.json" rel="external" target="_blank">configuration</a>. Here the node colour depends on the output of the ScaFi program, which is executed in each device every 1 second. Particularly, the execution of a ScaFi program deals with local computations and interaction among neighbours through a distributed data structure called <em>computational field</em>. This distributed and repeated execution of <em>rounds</em> eventually produces a collective result (you can find more details about the execution model of ScaFi programs in the <a href="https://scafi.github.io/docs/#execution-model" rel="external" target="_blank">documentation</a>).</p>
<p>In this case, the program consists of the evaluation of the distance from the node with the ID 100 (in Aggregate Computing literature called &ldquo;gradient&rdquo;).</p>
<!--
* download repo
* creation folder xxx
* command uiiuiii executed inside xxx

* Network of devices
* colors based on ...
* the simulator runs the program every x seconds
* the interaction among devices builds the distributed data structure
-->
<p><strong>Something wrong?</strong></p>
<p>Try the following:</p>
<ol>
<li>clone manually using <code>git clone https://github.com/scafi/learning-scafi-alchemist.git</code>
<ol>
<li>alternatively: download the repository zip (<a href="https://github.com/scafi/learning-scafi-alchemist/archive/refs/heads/master.zip" rel="external" target="_blank"><kbd>Download!</kbd></a>)</li>
<li>then unzip the repository to a local folder</li>
</ol>
</li>
<li>open a terminal inside the cloned/downloaded folder</li>
<li>run <code>./gradlew runHelloScafi</code></li>
</ol>
<p>If you still have problems executing the experiments, please consider opening an issue! <a href="https://github.com/scafi/learning-scafi-alchemist/issues/new" rel="external" target="_blank"><kbd> New issues</kbd></a></p>
<h2 id="guided-examples">Guided examples</h2>
<p>from now on, we will assume all commands have been issued inside <code>learning-scafi-alchemist</code></p>
<h3 id="1-hello-scafi-a-gradient-in-space-and-time">1. Hello, ScaFi! A gradient in space and time</h3>
<h4 id="launch-command">Launch command</h4>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./gradlew runHelloScafi</span></span></code></pre></div>
<h4 id="what-happened-1">What happened</h4>
<p>This is the example described in <a href="../../tutorials/scafi/index.html#quickstart">Quickstart</a> section.
Particularly, the program consists of the description of the self-healing gradient: an algorithm that computes a gradient (i.e.,  a field mapping each device in the system with its minimum distance from the closest <em>source</em> device) field
and automatically adjusts it after changes in the source set and the connectivity network (more details about gradients can be found in <a href="https://ieeexplore-ieee-org.ezproxy.unibo.it/document/8064033" rel="external" target="_blank">Compositional Blocks for Optimal Self-Healing Gradients</a>).</p>
<h4 id="what-is-inside">What is inside</h4>
<table>
  <thead>
      <tr>
          <th>Configuration File</th>
          <th>ScaFi Program File</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><a href="https://github.com/scafi/learning-scafi-alchemist/blob/master/src/main/yaml/helloScafi.yml" rel="external" target="_blank">helloScafi.yml</a></td>
          <td><a href="https://github.com/scafi/learning-scafi-alchemist/blob/master/src/main/scala/it/unibo/scafi/examples/HelloScafi.scala" rel="external" target="_blank">HelloScafi.scala</a></td>
      </tr>
  </tbody>
</table>
<p>An Alchemist simulation could be described through yml configurations.
In order to execute ScaFi script, you should at least define:</p>
<ul>
<li>the Scafi incarnation:</li>
</ul>
<!-- embedme ./src/main/yaml/helloScafi.yml#L1-L1 -->
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yml" data-lang="yml"><span style="display:flex;"><span><span style="color:#ff6ac1">incarnation</span>: scafi</span></span></code></pre></div>
<ul>
<li>a <code>Reaction</code> that contains the <code>Action</code> <code>RunScafiProgram</code> with the full class name of the program chosen</li>
</ul>
<!-- embedme ./src/main/yaml/helloScafi.yml#L37-L46 -->
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yml" data-lang="yml"><span style="display:flex;"><span><span style="color:#ff6ac1">_reactions</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ff6ac1">program</span>: <span style="color:#78787e">&amp;program</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ff6ac1">time-distribution</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#ff6ac1">type</span>: ExponentialTime
</span></span><span style="display:flex;"><span>          <span style="color:#ff6ac1">parameters</span>: [<span style="color:#78787e">*programRate]</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">type</span>: Event
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">actions</span>:
</span></span><span style="display:flex;"><span>          - <span style="color:#ff6ac1">type</span>: RunScafiProgram
</span></span><span style="display:flex;"><span>            <span style="color:#ff6ac1">parameters</span>: [it.unibo.scafi.examples.HelloScafi, *retentionTime]
</span></span><span style="display:flex;"><span>      - <span style="color:#ff6ac1">program</span>: send</span></span></code></pre></div>
<ul>
<li>a deployment that contains in the programs the Action specified above</li>
</ul>
<!-- embedme ./src/main/yaml/helloScafi.yml#L56-L60 -->
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yml" data-lang="yml"><span style="display:flex;"><span><span style="color:#ff6ac1">deployments</span>: <span style="color:#78787e">## i.e, how to place nodes</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff6ac1">type</span>: FromGPSTrace <span style="color:#78787e">## place nodes from gps traces</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff6ac1">parameters</span>: [<span style="color:#78787e">*totalNodes,</span> <span style="color:#78787e">*gpsTraceFile,</span> <span style="color:#ff6ac1">true</span>, <span style="color:#5af78e">&#34;AlignToTime&#34;</span>, <span style="color:#78787e">*timeToAlign,</span> <span style="color:#ff6ac1">false</span>, <span style="color:#ff6ac1">false</span>]
</span></span><span style="display:flex;"><span>  <span style="color:#ff6ac1">programs</span>: <span style="color:#78787e">## the reactions installed in each nodes</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#78787e">*program</span></span></span></code></pre></div>
<p>More details about the Alchemist configuration could be found in the <a href="http://alchemistsimulator.github.io/reference/yaml/" rel="external" target="_blank">official guide</a>.</p>
<p>The main logic of the node behaviour is described through the Scafi program file.
Particularly, a valid ScaFi program must:</p>
<ol>
<li>choose an incarnation</li>
</ol>
<!-- embedme ./src/main/scala/it/unibo/scafi/examples/HelloScafi.scala#L3-L3 -->
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#ff6ac1">import</span> it.unibo.alchemist.model.scafi.ScafiIncarnationForAlchemist._</span></span></code></pre></div>
<ol start="2">
<li>extend the <code>AggregateProgram</code> trait</li>
</ol>
<!-- embedme ./src/main/scala/it/unibo/scafi/examples/HelloScafi.scala#L7-L7 -->
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#ff6ac1">class</span> <span style="color:#f3f99d">HelloScafi</span> <span style="color:#ff6ac1">extends</span> <span style="color:#f3f99d">AggregateProgram</span></span></span></code></pre></div>
<ol start="3">
<li>mix-in the libraries required for the application</li>
</ol>
<!-- embedme ./src/main/scala/it/unibo/scafi/examples/HelloScafi.scala#L8-L8 -->
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#ff6ac1">with</span> <span style="color:#f3f99d">StandardSensors</span> <span style="color:#ff6ac1">with</span> <span style="color:#f3f99d">ScafiAlchemistSupport</span> <span style="color:#ff6ac1">with</span> <span style="color:#f3f99d">BlockG</span> <span style="color:#ff6ac1">with</span> <span style="color:#f3f99d">Gradients</span> <span style="color:#ff6ac1">with</span> <span style="color:#f3f99d">FieldUtils</span> <span style="color:#ff6ac1">{</span></span></span></code></pre></div>
<ol start="4">
<li>define the behaviour inside the <code>main</code> method.</li>
</ol>
<p>A ScaFi program typically deals with environment information through <strong>sensors</strong>.
<code>sense[Type](name)</code> is the built-in operator used to query the sensors attached to each node. Each <em>molecule</em> expressed in the yaml (i.e., the Alchemist variable concept) can be queried from the ScaFi program. For instance, in helloScafi, we write:</p>
<!-- embedme ./src/main/yaml/helloScafi.yml#L63-L64 -->
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>- <span style="color:#ff6ac1">molecule</span>: test
</span></span><span style="display:flex;"><span>  <span style="color:#ff6ac1">concentration</span>: <span style="color:#78787e">*source</span> <span style="color:#78787e"># anchor to &#34;source&#34; value, check line 17</span></span></span></code></pre></div>
<p>Therefore, in the program, we can get the <code>test</code> value as:</p>
<!-- embedme ./src/main/scala/it/unibo/scafi/examples/HelloScafi.scala#L11-L12 -->
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#78787e">// Access to node state through &#34;molecule&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span><span style="color:#ff6ac1">val</span> source <span style="color:#ff6ac1">=</span> sense<span style="color:#ff6ac1">[</span><span style="color:#9aedfe">Int</span><span style="color:#ff6ac1">](</span><span style="color:#5af78e">&#34;test&#34;</span><span style="color:#ff6ac1">)</span> <span style="color:#ff6ac1">//</span> <span style="color:#f3f99d">Alchemist</span> <span style="color:#f3f99d">API</span> <span style="color:#ff6ac1">=&gt;</span> node<span style="color:#ff6ac1">.</span>get<span style="color:#ff6ac1">(</span><span style="color:#5af78e">&#34;test&#34;</span><span style="color:#ff6ac1">)</span></span></span></code></pre></div>
<p>There are several built-sensors (in <code>checkSensors</code> there are examples of local sensors and neighbouring sensors).
For more details, please check the <a href="http://scafi-docs.surge.sh/it/unibo/scafi/index.html" rel="external" target="_blank">Scaladoc</a>.</p>
<p>The main logic of the program is expressed in the following line:</p>
<!-- embedme ./src/main/scala/it/unibo/scafi/examples/HelloScafi.scala#L13-L14 -->
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#78787e">// An aggregate operation
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span><span style="color:#ff6ac1">val</span> g <span style="color:#ff6ac1">=</span> classicGradient<span style="color:#ff6ac1">(</span>mid<span style="color:#ff6ac1">()</span> <span style="color:#ff6ac1">==</span> source<span style="color:#ff6ac1">)</span></span></span></code></pre></div>
<p>Where <code>classicGradient</code> is a function defined in <code>BlockG</code> that implements the self-healing gradient described above. The first argument is a <code>Boolean</code> field that defines which part of the system could be considered a <em>source</em> zone. In this case, nodes are marked as source when the field of ids (i.e., <code>mid()</code>)  is equal to the value passed through the variable <code>test</code>. This can be expressed as <code>mid() == source</code>.</p>
<p>The value produced by Scafi definitions could be used to express <em>actuation</em>. In the Scafi incarnation, you can update the Alchemist variables through <code>node.put</code></p>
<!-- embedme ./src/main/scala/it/unibo/scafi/examples/HelloScafi.scala#L15-L16 -->
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#78787e">// Write access to node state (i.e., Actuation =&gt; it changes the node state)
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>node<span style="color:#ff6ac1">.</span>put<span style="color:#ff6ac1">(</span><span style="color:#5af78e">&#34;g&#34;</span><span style="color:#ff6ac1">,</span> g<span style="color:#ff6ac1">)</span></span></span></code></pre></div>
<p>In the Alchemist default GUI you can inspect the node variables (i.e., molecules) by double-clicking a nodes
<a href="#R-image-1c12710a08fce39149a0e5414ef61ca8" class="lightbox-link"><img alt="Alchemist Molecule panel" class="lazy lightbox figure-image" loading="lazy" src="https://user-images.githubusercontent.com/23448811/176140035-dcc4078a-b71d-4eef-a8f2-5cdbc81b0c60.gif" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-1c12710a08fce39149a0e5414ef61ca8"><img alt="Alchemist Molecule panel" class="lazy lightbox lightbox-image" loading="lazy" src="https://user-images.githubusercontent.com/23448811/176140035-dcc4078a-b71d-4eef-a8f2-5cdbc81b0c60.gif"></a></p>
<p>Finally, the last instruction of the main is the returned value of the Scafi program (in scala <code>return</code> is optional)</p>
<!-- embedme ./src/main/scala/it/unibo/scafi/examples/HelloScafi.scala#L17-L18 -->
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#78787e">// Return value of the program
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>g</span></span></code></pre></div>
<h4 id="minimal-changes">Minimal changes</h4>
<ol>
<li>As described above, the program is <em>self-healing</em>, so try to move node and see how the system eventually reaches a stable condition:
<ul>
<li>click <kbd>S</kbd> to enter into selection mode</li>
<li>start a selection by clicking the mouse left button and dragging it into the environment</li>
<li>once your selection is over, click <kbd>O</kbd> to enter into move mode</li>
<li>click over the selection and drag the element into another position
<a href="#R-image-48571c5838e11d708c2fc6c2a781ba87" class="lightbox-link"><img alt="Alchemist Move elements" class="lazy lightbox figure-image" loading="lazy" src="https://user-images.githubusercontent.com/23448811/175920712-e193cf6d-6797-46e9-bc02-c0218f3bf583.gif" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-48571c5838e11d708c2fc6c2a781ba87"><img alt="Alchemist Move elements" class="lazy lightbox lightbox-image" loading="lazy" src="https://user-images.githubusercontent.com/23448811/175920712-e193cf6d-6797-46e9-bc02-c0218f3bf583.gif"></a></li>
</ul>
</li>
<li>Try to modify the source node (via yml configuration) and check the program output differences</li>
<li>Try to change the source node (i.e. with the ID == 10) after 10 seconds (check <code>BlockT</code> library, or you can implement the time progression with <code>rep(0 seconds)(time =&gt; time + deltaTime)</code>)</li>
</ol>
<h4 id="using-the-generated-data-with-the-embedded-plotting-script">Using the generated data with the embedded plotting script</h4>
<p>You can produce plots from the data generated by Alchemist simulations.
Indeed, each Alchemist simulation produces aggregated data as expressed in the <code>export</code> configuration <a href="https://github.com/scafi/learning-scafi-alchemist/blob/master/src/main/yaml/helloScafi.yml#L68-L83" rel="external" target="_blank">section</a>. For more details about data exporting, please refer to the official Alchemist <a href="http://alchemistsimulator.github.io/howtos/simulation/export/" rel="external" target="_blank">guide</a>.<br>
Particularly, this command:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./gradlew runHelloScafi -Pbatch<span style="color:#ff6ac1">=</span><span style="color:#ff5c57">true</span> -Pvariables<span style="color:#ff6ac1">=</span>random</span></span></code></pre></div>
<p>will run several simulations in batch, one for each possible value of the random variables (six in this case, as expressed in the <a href="https://github.com/scafi/learning-scafi-alchemist/blob/master/src/main/yaml/helloScafi.yml#L4-L8" rel="external" target="_blank">helloScafi.yml</a>). Each simulation, will produce a csv file in <code>$exportPath/$fileNameRoot-randomValue.$fileExtension</code> (in this case, build/exports/helloScafi/experiment-x.txt, the values starting with $ are gathered from the simulation configuration file).</p>
<p>Typically, we use these data to produce charts that express the dynamics of the collective system.
This repository contains a highly configurable script (please look at the configuration defined in <a href="https://github.com/scafi/learning-scafi-alchemist/tree/master/plots" rel="external" target="_blank">plots</a>).</p>
<p>To run the script for this experiment, you should run:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ python plotter.py plots/helloScafi.yml ./build/exports/helloScafi <span style="color:#5af78e">&#34;.*&#34;</span> <span style="color:#5af78e">&#34;result&#34;</span> plots/ </span></span></code></pre></div>
<p>Where:</p>
<ul>
<li>the first argument is the plot configuration (expressed using a yaml file)</li>
<li>the second argument is where the files are located</li>
<li>the third argument is a regex used to select the simulations file</li>
<li>the fourth argument defines the initial names of the plot</li>
<li>the last argument devises the folder in which the plots will be stored</li>
</ul>
<h3 id="2-a-richer-pattern-self-organizing-coordination-regions">2. A richer pattern: Self-organizing Coordination Regions</h3>
<h4 id="launch-command-1">Launch command</h4>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./gradlew runSelforgCoordRegions</span></span></code></pre></div>
<h4 id="what-happened-2">What happened</h4>
<p>This example shows an interesting pattern developed with ScaFi, the so-called Self-Organising Coordination Regions (SCR).
(more details in <a href="https://hal.inria.fr/hal-02365498/document" rel="external" target="_blank">Self-organising Coordination Regions: A Pattern for
Edge Computing</a>)</p>
<p>The idea of SCR is to organize a distributed activity
into multiple spatial <strong>regions</strong> (inducing a partition of the system),
each one controlled by a <strong>leader</strong> device,
which collects data from the area members
and spreads decisions to enact some area-wide policy.
Particularly, when you launch the command of SCR you will see something like this:</p>
<p><a href="#R-image-c4cc41a266aa222188b8d78e7af3cf4d" class="lightbox-link"><img alt="SCR result" class="lazy lightbox figure-image" loading="lazy" src="https://user-images.githubusercontent.com/23448811/175658741-08537743-a325-4137-be14-a4dd6532237b.gif" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-c4cc41a266aa222188b8d78e7af3cf4d"><img alt="SCR result" class="lazy lightbox lightbox-image" loading="lazy" src="https://user-images.githubusercontent.com/23448811/175658741-08537743-a325-4137-be14-a4dd6532237b.gif"></a></p>
<p>Where the colour denotes the potential field (i.e., the gradient) that starts from the selected leader.
In this GIF, the leaders are the ones marked with blue colour.</p>
<h4 id="what-is-inside-1">What is inside</h4>
<table>
  <thead>
      <tr>
          <th>Configuration File</th>
          <th>ScaFi Program File</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><a href="https://github.com/scafi/learning-scafi-alchemist/blob/master/src/main/yaml/selforgCoordRegions.yml" rel="external" target="_blank">selforgCoordRegions.yml</a></td>
          <td><a href="https://github.com/scafi/learning-scafi-alchemist/blob/master/src/main/scala/it/unibo/scafi/examples/SelforganisingCoordinationRegions.scala" rel="external" target="_blank">SelforganisingCoordinationRegions.scala</a></td>
      </tr>
  </tbody>
</table>
<p>The SCR pattern consists of four main phases:</p>
<ol>
<li>leader election: using block <code>S</code> the system will produce a distributed leader election that tries to divide the system equally with a certain range (in S term, it is called <code>grain</code>):</li>
</ol>
<!-- embedme ./src/main/scala/it/unibo/scafi/examples/SelforganisingCoordinationRegions.scala#L14-L15 -->
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#78787e">// Sparse choice (leader election) of the cluster heads
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span><span style="color:#ff6ac1">val</span> leader <span style="color:#ff6ac1">=</span> S<span style="color:#ff6ac1">(</span>sense<span style="color:#ff6ac1">(</span><span style="color:#f3f99d">Params</span><span style="color:#ff6ac1">.</span><span style="color:#f3f99d">GRAIN</span><span style="color:#ff6ac1">),</span> metric <span style="color:#ff6ac1">=</span> nbrRange<span style="color:#ff6ac1">)</span></span></span></code></pre></div>
<ol start="2">
<li>potential field definition: after the leader election process, there is another phase in which will be computed potential field from the leader. In this way, the slave node could send information to leader&rsquo;s</li>
</ol>
<!-- embedme ./src/main/scala/it/unibo/scafi/examples/SelforganisingCoordinationRegions.scala#L16-L17 -->
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#78787e">// G block to run a gradient from the leaders
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span><span style="color:#ff6ac1">val</span> g <span style="color:#ff6ac1">=</span> distanceTo<span style="color:#ff6ac1">(</span>leader<span style="color:#ff6ac1">,</span> metric <span style="color:#ff6ac1">=</span> nbrRange<span style="color:#ff6ac1">)</span></span></span></code></pre></div>
<ol start="3">
<li>collection phase: the slave node could collect local information (e.g., temperature) and send it to the leader. During the path, it will be an aggregation process that combines local information with area information (i.e., all the nodes that are inside the potential field of a leader)</li>
</ol>
<!-- embedme ./src/main/scala/it/unibo/scafi/examples/SelforganisingCoordinationRegions.scala#L18-L19 -->
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#78787e">// C block to collect information towards the leaders
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span><span style="color:#ff6ac1">val</span> c <span style="color:#ff6ac1">=</span> C<span style="color:#ff6ac1">[</span><span style="color:#9aedfe">Double</span>,<span style="color:#9aedfe">Set</span><span style="color:#ff6ac1">[</span><span style="color:#9aedfe">ID</span><span style="color:#ff6ac1">]](</span>g<span style="color:#ff6ac1">,</span> <span style="color:#ff6ac1">_</span><span style="color:#ff6ac1">++</span><span style="color:#ff6ac1">_</span><span style="color:#ff6ac1">,</span> <span style="color:#f3f99d">Set</span><span style="color:#ff6ac1">(</span>mid<span style="color:#ff6ac1">()),</span> <span style="color:#f3f99d">Set</span><span style="color:#ff6ac1">.</span>empty<span style="color:#ff6ac1">)</span></span></span></code></pre></div>
<ol start="4">
<li>leader choice and share: with the information collected inside an area, the leader could perform an area-wide decision and then send it to the whole area (using <code>G</code>)</li>
</ol>
<!-- embedme ./src/main/scala/it/unibo/scafi/examples/SelforganisingCoordinationRegions.scala#L20-L22 -->
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#78787e">// G block to propagate decisions or aggregated info from leaders to members
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span><span style="color:#ff6ac1">val</span> info <span style="color:#ff6ac1">=</span> G<span style="color:#ff6ac1">[</span><span style="color:#9aedfe">Set</span><span style="color:#ff6ac1">[</span><span style="color:#9aedfe">ID</span><span style="color:#ff6ac1">]](</span>leader<span style="color:#ff6ac1">,</span> c<span style="color:#ff6ac1">,</span> identity<span style="color:#ff6ac1">,</span> metric <span style="color:#ff6ac1">=</span> nbrRange<span style="color:#ff6ac1">)</span>
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">val</span> head <span style="color:#ff6ac1">=</span> G<span style="color:#ff6ac1">[</span><span style="color:#9aedfe">ID</span><span style="color:#ff6ac1">](</span>leader<span style="color:#ff6ac1">,</span> mid<span style="color:#ff6ac1">(),</span> identity<span style="color:#ff6ac1">,</span> metric <span style="color:#ff6ac1">=</span> nbrRange<span style="color:#ff6ac1">)</span></span></span></code></pre></div>
<h4 id="minimal-changes-1">Minimal changes</h4>
<ol>
<li>Try to change the grain (check in the configuration file). It would lead to changes in area formation</li>
<li>Try to count the number of nodes inside an area and share this information with that area&mdash;suggestion: change phase 3. of the SCR</li>
<li>As in the previous example, the areas are self-healing. Therefore try to move leaders and see what happens in the leader formation. Try to remove nodes too (see the next clip)
<a href="#R-image-2246c6142b6f3f1d3f1c65dc20e5f35f" class="lightbox-link"><img alt="ezgif com-gif-maker" class="lazy lightbox figure-image" loading="lazy" src="https://user-images.githubusercontent.com/23448811/179356424-bd31b95a-e38a-491a-80d3-cc448059e484.gif" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-2246c6142b6f3f1d3f1c65dc20e5f35f"><img alt="ezgif com-gif-maker" class="lazy lightbox lightbox-image" loading="lazy" src="https://user-images.githubusercontent.com/23448811/179356424-bd31b95a-e38a-491a-80d3-cc448059e484.gif"></a></li>
</ol>
<h3 id="3-overlapping-computations-in-space-and-time-with-aggregate-processes">3. Overlapping computations in space and time with aggregate processes</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./gradlew runAggregateProcesses</span></span></code></pre></div>
<h4 id="what-happened-3">What happened</h4>
<p>This example shows an application of Aggregate Processes,
which is s a way to specify a dynamic number of collective
computations running on dynamic ensembles of devices (more details in <a href="https://www.sciencedirect.com/science/article/abs/pii/S0952197620303389" rel="external" target="_blank">Engineering collective intelligence at the edge with aggregate processes</a>).
<a href="#R-image-d1b2d87c3c3415cf1178c2b914ed8752" class="lightbox-link"><img alt="Processes API" class="lazy lightbox figure-image" loading="lazy" src="https://user-images.githubusercontent.com/23448811/175660568-9906a920-d701-48ce-a0de-a0d6fa146425.gif" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-d1b2d87c3c3415cf1178c2b914ed8752"><img alt="Processes API" class="lazy lightbox lightbox-image" loading="lazy" src="https://user-images.githubusercontent.com/23448811/175660568-9906a920-d701-48ce-a0de-a0d6fa146425.gif"></a></p>
<p>The processes are the bigger circle around the nodes. The colour identifies the process ID. As you can see,
during the simulation the process starts, shrink and then could disappear.</p>
<h4 id="what-is-inside-2">What is inside</h4>
<table>
  <thead>
      <tr>
          <th>Configuration File</th>
          <th>ScaFi Program File</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><a href="https://github.com/scafi/learning-scafi-alchemist/blob/master/src/main/yaml/aggregateProcesses.yml" rel="external" target="_blank">aggregateProcesses.yml</a></td>
          <td><a href="https://github.com/scafi/learning-scafi-alchemist/blob/master/src/main/scala/it/unibo/scafi/examples/AggregateProcesses.scala" rel="external" target="_blank">SelforganisingCoordinationRegions.scala</a></td>
      </tr>
  </tbody>
</table>
<h4 id="minimal-changes-2">Minimal changes</h4>
<p>To start the process, you can use the <code>spawn</code> operators (and their variation, <code>sspawn</code>, <code>cspawn</code>, etc.):</p>
<!-- embedme ./src/main/scala/it/unibo/scafi/examples/AggregateProcesses.scala#L24-L24 -->
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#ff6ac1">val</span> maps <span style="color:#ff6ac1">=</span> sspawn<span style="color:#ff6ac1">[</span><span style="color:#9aedfe">Pid</span>,<span style="color:#9aedfe">Unit</span>,<span style="color:#9aedfe">Double</span><span style="color:#ff6ac1">](</span>process<span style="color:#ff6ac1">,</span> pids<span style="color:#ff6ac1">,</span> <span style="color:#ff6ac1">{})</span></span></span></code></pre></div>
<p>Particularly, <code>sspawn</code> accepts:</p>
<ul>
<li>the process logic, that is a function <code>ID =&gt; Input =&gt; Pout[Out]</code>
<ul>
<li><code>ID</code> in this case is a <code>case class</code> that contains the <code>id</code> of a node that will start the process, the time in which it will effectively start and finally the time in which it will end.</li>
</ul>
  <!-- embedme ./src/main/scala/it/unibo/scafi/examples/AggregateProcesses.scala#L41-L42 -->
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#ff6ac1">case</span> <span style="color:#ff6ac1">class</span> <span style="color:#f3f99d">Pid</span><span style="color:#ff6ac1">(</span>src<span style="color:#ff6ac1">:</span> <span style="color:#9aedfe">ID</span> <span style="color:#ff6ac1">=</span> mid<span style="color:#ff6ac1">(),</span> time<span style="color:#ff6ac1">:</span> <span style="color:#9aedfe">Long</span> <span style="color:#ff6ac1">=</span> alchemistTimestamp<span style="color:#ff6ac1">.</span>toDouble<span style="color:#ff6ac1">.</span>toLong<span style="color:#ff6ac1">)</span>
</span></span><span style="display:flex;"><span>              <span style="color:#ff6ac1">(</span><span style="color:#ff6ac1">val</span> terminateAt<span style="color:#ff6ac1">:</span> <span style="color:#9aedfe">Long</span> <span style="color:#ff6ac1">=</span> <span style="color:#f3f99d">Long</span><span style="color:#ff6ac1">.</span><span style="color:#f3f99d">MaxValue</span><span style="color:#ff6ac1">)</span></span></span></code></pre></div>
<ul>
<li>The input of the process (in this case is empty)</li>
<li>Finally, the <code>Pout[Double]</code> is the process output. <code>Pout</code> is a data structure that contains the output of the process and the status of the process (that could be <code>Output</code>, <code>Terminated</code> and <code>External</code>&mdash;more details in the paper).</li>
</ul>
</li>
<li>The key set of the process that will be spawn (<code>pids</code>)
<ul>
<li>In this case, the new <code>pids</code> associated to new processes are selected from Alchemist molecule.</li>
</ul>
   <!-- embedme ./src/main/scala/it/unibo/scafi/examples/AggregateProcesses.scala#L11-L11 -->
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#ff6ac1">def</span> processesSpec<span style="color:#ff6ac1">:</span> <span style="color:#9aedfe">Map</span><span style="color:#ff6ac1">[</span><span style="color:#9aedfe">Int</span>,<span style="color:#ff6ac1">(</span><span style="color:#9aedfe">Int</span>,<span style="color:#9aedfe">Int</span><span style="color:#ff6ac1">)]</span> <span style="color:#ff6ac1">=</span> sense<span style="color:#ff6ac1">(</span><span style="color:#f3f99d">MOLECULE_PROCS</span><span style="color:#ff6ac1">)</span></span></span></code></pre></div>
<ul>
<li>From this information il will be created the <code>pids</code> for the processes:</li>
</ul>
  <!-- embedme ./src/main/scala/it/unibo/scafi/examples/AggregateProcesses.scala#L18-L22 -->
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#78787e">// Determine the processes to be generated (these are provided in a molecule &#34;procs&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span><span style="color:#ff6ac1">val</span> procs<span style="color:#ff6ac1">:</span> <span style="color:#9aedfe">Set</span><span style="color:#ff6ac1">[</span><span style="color:#9aedfe">ProcessSpec</span><span style="color:#ff6ac1">]</span> <span style="color:#ff6ac1">=</span> processesSpec<span style="color:#ff6ac1">.</span>map<span style="color:#ff6ac1">(</span>tp <span style="color:#ff6ac1">=&gt;</span> <span style="color:#f3f99d">ProcessSpec</span><span style="color:#ff6ac1">.</span>fromTuple<span style="color:#ff6ac1">(</span>tp<span style="color:#ff6ac1">.</span>_1<span style="color:#ff6ac1">,</span> tp<span style="color:#ff6ac1">.</span>_2<span style="color:#ff6ac1">)).</span>toSet
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">val</span> t <span style="color:#ff6ac1">=</span> alchemistTimestamp<span style="color:#ff6ac1">.</span>toDouble<span style="color:#ff6ac1">.</span>toLong
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">val</span> pids<span style="color:#ff6ac1">:</span> <span style="color:#9aedfe">Set</span><span style="color:#ff6ac1">[</span><span style="color:#9aedfe">Pid</span><span style="color:#ff6ac1">]</span> <span style="color:#ff6ac1">=</span> procs<span style="color:#ff6ac1">.</span>filter<span style="color:#ff6ac1">(</span>tgen <span style="color:#ff6ac1">=&gt;</span> tgen<span style="color:#ff6ac1">.</span>device <span style="color:#ff6ac1">==</span> mid<span style="color:#ff6ac1">()</span> <span style="color:#ff6ac1">&amp;&amp;</span> t <span style="color:#ff6ac1">&gt;</span> tgen<span style="color:#ff6ac1">.</span>startTime <span style="color:#ff6ac1">&amp;&amp;</span> <span style="color:#ff6ac1">(</span>t <span style="color:#ff6ac1">-</span> <span style="color:#ff9f43">5</span><span style="color:#ff6ac1">)</span> <span style="color:#ff6ac1">&lt;</span> tgen<span style="color:#ff6ac1">.</span>startTime<span style="color:#ff6ac1">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff6ac1">.</span>map<span style="color:#ff6ac1">(</span>tgen <span style="color:#ff6ac1">=&gt;</span> <span style="color:#f3f99d">Pid</span><span style="color:#ff6ac1">(</span>time <span style="color:#ff6ac1">=</span> tgen<span style="color:#ff6ac1">.</span>startTime<span style="color:#ff6ac1">)(</span>terminateAt <span style="color:#ff6ac1">=</span> tgen<span style="color:#ff6ac1">.</span>endTime<span style="color:#ff6ac1">))</span></span></span></code></pre></div>
</li>
</ul>
<p>Particularly, in this case, the process logic is quite simple:</p>
<ul>
<li>it produces a potential field from the processes creator</li>
<li>it terminates if the <code>terminateAt</code> is reached</li>
<li>the nodes that belong to nodes are the ones that are inside the <code>bubble</code>, that is the nodes inside an area of 200 units</li>
</ul>
<!-- embedme ./src/main/scala/it/unibo/scafi/examples/AggregateProcesses.scala#L44-L50 -->
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#ff6ac1">def</span> process<span style="color:#ff6ac1">(</span>pid<span style="color:#ff6ac1">:</span> <span style="color:#9aedfe">Pid</span><span style="color:#ff6ac1">)(</span>src<span style="color:#ff6ac1">:</span> <span style="color:#9aedfe">Unit</span> <span style="color:#ff6ac1">=</span> <span style="color:#ff6ac1">())</span><span style="color:#ff6ac1">:</span> <span style="color:#9aedfe">POut</span><span style="color:#ff6ac1">[</span><span style="color:#9aedfe">Double</span><span style="color:#ff6ac1">]</span> <span style="color:#ff6ac1">=</span> <span style="color:#ff6ac1">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff6ac1">val</span> g <span style="color:#ff6ac1">=</span> classicGradient<span style="color:#ff6ac1">(</span>pid<span style="color:#ff6ac1">.</span>src<span style="color:#ff6ac1">==</span>mid<span style="color:#ff6ac1">())</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff6ac1">val</span> s <span style="color:#ff6ac1">=</span> <span style="color:#ff6ac1">if</span><span style="color:#ff6ac1">(</span>pid<span style="color:#ff6ac1">.</span>src<span style="color:#ff6ac1">==</span>mid<span style="color:#ff6ac1">()</span> <span style="color:#ff6ac1">&amp;&amp;</span> pid<span style="color:#ff6ac1">.</span>terminateAt<span style="color:#ff6ac1">.</span>toDouble <span style="color:#ff6ac1">&lt;=</span> alchemistTimestamp<span style="color:#ff6ac1">.</span>toDouble<span style="color:#ff6ac1">){</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f3f99d">Terminated</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff6ac1">}</span> <span style="color:#ff6ac1">else</span> <span style="color:#ff6ac1">if</span><span style="color:#ff6ac1">(</span>g <span style="color:#ff6ac1">&lt;</span> <span style="color:#ff9f43">200</span><span style="color:#ff6ac1">)</span> <span style="color:#f3f99d">Output</span> <span style="color:#ff6ac1">else</span> <span style="color:#f3f99d">External</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f3f99d">POut</span><span style="color:#ff6ac1">(</span>g<span style="color:#ff6ac1">,</span> s<span style="color:#ff6ac1">)</span>
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">}</span></span></span></code></pre></div>
<h4 id="minimal-changes-3">Minimal changes</h4>
<ul>
<li>Try to add the extension of the <code>bubble</code> as a parameter (as the start and end time)</li>
<li>Even in this case, the computation is self-healing. Therefore, try to move the process center to see how the system reacts</li>
<li>Try to add other processess (see the yaml configuration)</li>
</ul>
<h2 id="external-resources-to-improve-your-understanding">External resources to improve your understanding</h2>
<ul>
<li>The Alchemist metamodel: <a href="https://alchemistsimulator.github.io/explanation/" rel="external" target="_blank">https://alchemistsimulator.github.io/explanation/</a></li>
<li>The Alchemist Simulator reference <a href="https://alchemistsimulator.github.io/reference/yaml/" rel="external" target="_blank">https://alchemistsimulator.github.io/reference/yaml/</a></li>
<li>ScaFi documentation: <a href="https://scafi.github.io/docs/" rel="external" target="_blank">https://scafi.github.io/docs/</a></li>
<li>Main scientific papers about ScaFI (and that use ScaFi): <a href="https://scafi.github.io/papers/" rel="external" target="_blank">https://scafi.github.io/papers/</a></li>
</ul>

<details open class=" box cstyle notices note">
  <summary class="box-label" tabindex="-1">
    <i class="fa-fw fas fa-exclamation-circle"></i> 
    Note
  </summary>
  <div class="box-content">
<p>Something went wrong along the line? Drop us an
<a href="https://github.com/scafi/learning-scafi-alchemist/issues/new/choose" rel="external" target="_blank">issue report</a>
and we&rsquo;ll get back to you.</p>
  </div>
</details>

  <footer class="footline">
  </footer>
</article>
        </div>
      </main>
    </div>
    <aside id="R-sidebar" class="default-animation showVisitedLinks">
      <div id="R-header-topbar" class="default-animation"></div>
      <div id="R-header-wrapper" class="default-animation">
        <div id="R-header" class="default-animation">
<div style="white-space: nowrap;">
    <div style="max-width: 100%; display: inline-block; ">
        <img alt="The Alchemist Logo" src="../../images/logo.svg"/>
    </div>
</div>

        </div>
        <search><form action="../../search/index.html" method="get">
          <div class="searchbox default-animation">
            <button class="search-detail" type="submit" title="Search (CTRL+ALT+f)"><i class="fas fa-search"></i></button>
            <label class="a11y-only" for="R-search-by">Search</label>
            <input data-search-input id="R-search-by" name="search-by" class="search-by" type="search" placeholder="Search...">
            <button class="search-clear" type="button" data-search-clear="" title="Clear search"><i class="fas fa-times" title="Clear search"></i></button>
          </div>
        </form></search>
      </div>
      <div id="R-homelinks" class="default-animation homelinks">
        <ul>
          <li><a class="padding" href="../../index.html"><i class="fa-fw fas fa-home"></i> Home</a></li>
        </ul>
        <hr class="padding">
      </div>
      <div id="R-content-wrapper" class="highlightable">
        <div id="R-shortcutmenu-home" class="R-sidebarmenu">
          <ul class="enlarge morespace collapsible-menu">
            <li class="parent " data-nav-id="/tutorials/index.html"><a class="padding" href="../../tutorials/index.html"><b>1. </b>Tutorials<i class="fa-fw fas fa-check read-icon"></i></a><ul id="R-subsections-e1e8c1e70c5500b49e8dda2dc550651a" class="collapsible-menu">
            <li class="" data-nav-id="/tutorials/quickstart/index.html"><a class="padding" href="../../tutorials/quickstart/index.html">Quickstart<i class="fa-fw fas fa-check read-icon"></i></a></li>
            <li class="" data-nav-id="/tutorials/basics/index.html"><a class="padding" href="../../tutorials/basics/index.html">Step-by-step tutorial<i class="fa-fw fas fa-check read-icon"></i></a></li>
            <li class="" data-nav-id="/tutorials/protelis/index.html"><a class="padding" href="../../tutorials/protelis/index.html">Protelis Incarnation Tutorial<i class="fa-fw fas fa-check read-icon"></i></a></li>
            <li class="" data-nav-id="/tutorials/sapere/index.html"><a class="padding" href="../../tutorials/sapere/index.html">SAPERE Incarnation Tutorial<i class="fa-fw fas fa-check read-icon"></i></a></li>
            <li class="active " data-nav-id="/tutorials/scafi/index.html"><a class="padding" href="../../tutorials/scafi/index.html">Scafi Incarnation Tutorial<i class="fa-fw fas fa-check read-icon"></i></a></li></ul></li>
            <li class="" data-nav-id="/howtos/index.html"><a class="padding" href="../../howtos/index.html"><b>2. </b>How-to Guides<i class="fa-fw fas fa-check read-icon"></i></a><ul id="R-subsections-435cd60099784c14f4922700a72c8414" class="collapsible-menu"></ul></li>
            <li class="" data-nav-id="/explanation/index.html"><a class="padding" href="../../explanation/index.html"><b>3. </b>Explanation<i class="fa-fw fas fa-check read-icon"></i></a><ul id="R-subsections-547d30965b8467ddcbfa08ec6013372a" class="collapsible-menu"></ul></li>
            <li class="" data-nav-id="/reference/index.html"><a class="padding" href="../../reference/index.html"><b>4. </b>Reference<i class="fa-fw fas fa-check read-icon"></i></a><ul id="R-subsections-66002f201bef818664bb81aa67490c58" class="collapsible-menu"></ul></li>
          </ul>
        </div>
        <div id="R-shortcutmenu-shortcuts" class="R-sidebarmenu">
          <div class="nav-title padding">More</div>
          <ul class="space collapsible-menu">
            <li class="" data-nav-id="https://github.com/AlchemistSimulator/Alchemist"><a class="padding" href="https://github.com/AlchemistSimulator/Alchemist" rel="external" target="_blank"><i class='fab fa-fw fa-github'></i> GitHub repo<i class="fa-fw fas fa-check read-icon"></i></a></li>
            <li class="" data-nav-id="https://youtube.com/@alchemistsimulator"><a class="padding" href="https://youtube.com/@alchemistsimulator" rel="external" target="_blank"><i class='fab fa-youtube'></i> YouTube channel<i class="fa-fw fas fa-check read-icon"></i></a></li>
            <li class="" data-nav-id="/showcase/"><a class="padding" href="../../showcase/"><i class='fas fa-fw fa-camera'></i> Use cases<i class="fa-fw fas fa-check read-icon"></i></a></li>
            <li class="" data-nav-id="/license/"><a class="padding" href="../../license/"><i class='fas fa-balance-scale'></i> License<i class="fa-fw fas fa-check read-icon"></i></a></li>
            <li class="" data-nav-id="/tags/"><a class="padding" href="../../tags/"><i class='fas fa-fw fa-tags'></i> Tags<i class="fa-fw fas fa-check read-icon"></i></a></li>
          </ul>
        </div>
        <div class="padding footermargin footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter showVisitedLinks showFooter"></div>
        <div id="R-menu-footer">
          <hr class="padding default-animation footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter showVisitedLinks showFooter">
          <div id="R-prefooter" class="footerLangSwitch footerVariantSwitch footerVisitedLinks showVisitedLinks">
            <ul>
              <li id="R-select-language-container" class="footerLangSwitch">
                <div class="padding menu-control">
                  <i class="fa-fw fas fa-language"></i>
                  <span>&nbsp;</span>
                  <div class="control-style">
                    <label class="a11y-only" for="R-select-language">Language</label>
                    <select id="R-select-language" onchange="location = this.querySelector( this.value ).dataset.url;">
                      <option id="R-select-language-en" value="#R-select-language-en" data-url="../../tutorials/scafi/index.html" lang="en" selected>English</option>
                    </select>
                  </div>
                  <div class="clear"></div>
                </div>
              </li>
              <li id="R-select-variant-container" class="footerVariantSwitch">
                <div class="padding menu-control">
                  <i class="fa-fw fas fa-paint-brush"></i>
                  <span>&nbsp;</span>
                  <div class="control-style">
                    <label class="a11y-only" for="R-select-variant">Theme</label>
                    <select id="R-select-variant" onchange="window.relearn.changeVariant( this.value );">
                      <option id="R-select-variant-relearn" value="relearn" selected>Relearn</option>
                    </select>
                  </div>
                  <div class="clear"></div>
                </div>
                <script>window.relearn.markVariant();</script>
              </li>
              <li class="footerVisitedLinks showVisitedLinks">
                <div class="padding menu-control">
                  <i class="fa-fw fas fa-history"></i>
                  <span>&nbsp;</span>
                  <div class="control-style">
                    <button onclick="clearHistory();">Clear History</button>
                  </div>
                  <div class="clear"></div>
                </div>
              </li>
            </ul>
          </div>
          <div id="R-footer" class="footerFooter showFooter"><div class="padding">
    <div><strong>Alchemist Simulator 41.0.0</strong></div>
    <br>
    <a
        class="github-button"
        href="https://github.com/AlchemistSimulator/Alchemist/releases/latest/"
        data-icon="octicon-cloud-download" aria-label="Download Alchemist-full on GitHub"
    >
    Download
    </a>
    <a
        class="github-button"
        href="https://github.com/AlchemistSimulator/Alchemist"
        data-icon="octicon-star"
        data-show-count="true"
        aria-label="Star McShelby/hugo-theme-relearn on GitHub"
    >
    Star
    </a>
    <a
        class="github-button"
        href="https://github.com/AlchemistSimulator/Alchemist/fork"
        data-icon="octicon-repo-forked"
        data-show-count="true"
        aria-label="Fork McShelby/hugo-theme-relearn on GitHub"
    >
    Fork
    </a>
    <p>Built with <a href="https://github.com/McShelby/hugo-theme-relearn"><span class="fas fa-heart"></span></a> by <a href="https://gohugo.io/">Hugo</a></p>
    <script async defer src="https://buttons.github.io/buttons.js"></script>
</div>
          </div>
        </div>
      </div>
    </aside>
    <script src="../../js/clipboard/clipboard.min.js?1741606751" defer></script>
    <script src="../../js/perfect-scrollbar/perfect-scrollbar.min.js?1741606751" defer></script>
    <script src="../../js/js-yaml/js-yaml.min.js?1741606751" defer></script>
    <script src="../../js/d3/d3-color.min.js?1741606751" defer></script>
    <script src="../../js/d3/d3-dispatch.min.js?1741606751" defer></script>
    <script src="../../js/d3/d3-drag.min.js?1741606751" defer></script>
    <script src="../../js/d3/d3-ease.min.js?1741606751" defer></script>
    <script src="../../js/d3/d3-interpolate.min.js?1741606751" defer></script>
    <script src="../../js/d3/d3-selection.min.js?1741606751" defer></script>
    <script src="../../js/d3/d3-timer.min.js?1741606751" defer></script>
    <script src="../../js/d3/d3-transition.min.js?1741606751" defer></script>
    <script src="../../js/d3/d3-zoom.min.js?1741606751" defer></script>
    <script src="../../js/mermaid/mermaid.min.js?1741606751" defer></script>
    <script>
      window.relearn.themeUseMermaid = JSON.parse("{}");
    </script>
    <script src="../../js/theme.min.js?1741606751" defer></script>
  </body>
</html>
